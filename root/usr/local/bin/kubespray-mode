#!/bin/bash

if [ $# -eq 0 ] || [[ "$1" =~ (-h|--help) ]] ; then
    echo "Usage: $0 [terraform-provision|terraform-install]"
    exit
fi

case $1 in
  terraform-provision) value=false;;
  terraform-install) value=true;;
  *)
    echo "Usage: $0 [terraform-provision|terraform-install]"
    exit 1
esac

set -eu

source /etc/profile.d/getup.sh

if grep -q '^deploy_components.*' $TF_VARS_FILE; then
    sed -i -e "s/^deploy_components.*/deploy_components = $value/" $TF_VARS_FILE
elif grep -q '^#deploy_components.*' $TF_VARS_FILE; then
    sed -i -e "s/^#deploy_components.*/deploy_components = $value/" $TF_VARS_FILE
else
  echo "deploy_components = $value" >> $TF_VARS_FILE
fi

echo "Changed $TF_VARS_FILE: deploy_components=$value"
